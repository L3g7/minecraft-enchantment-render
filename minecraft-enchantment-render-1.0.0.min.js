// minecraft-enchantment-render v1.0.0
// 
// MIT License
// 
// Copyright (c) 2025 L3g7
// 
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
// 
// The above copyright notice and this permission notice shall be included in all
// copies or substantial portions of the Software.
// 
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
// SOFTWARE.
// 
class W{constructor(q){this.generator=q}create(q){return this.generator(q)}}var p=[104,49,91,56,79,98,109,89,86,113,107,132,130,160,108,106,116,109,163,221,184,160,149,131,134,134,63,24,65,78,94,125,121,121,131,93,126,143,144,166,155,189,204,255,229,218,209,197,154,105,104,156,139,137,87,80,111,87,95,103,108,148,152,75],w=new ImageData(new Uint8ClampedArray(new Array(64).fill(p.map((q)=>[q*128/255,q*64/255,q*204/255,255])).flat(2)),64,64),x=new W((q)=>{let K=V(q,U(1,[[1,1,1],[0,1,1],[0,0,1],[1,0,1]])),Q=O(q,1),J=C(q,1,[[0,0]]),Y=R(q,[255]);return{position:K,indices:Q,texture:J,lighting:Y,vertexCount:6,scalePadded:1,scaleUnpadded:1,is3D:!1}}),m=new W((q)=>{let K=V(q,U(1,[[0,1,1],[1,1,1],[1,1,0],[0,1,0],[0,1,1],[0,1,0],[0,0,0],[0,0,1],[1,1,1],[0,1,1],[0,0,1],[1,0,1]])),Q=O(q,3),J=C(q,2,[[0,0],[0,1],[1,0]]),Y=R(q,[255,162,111]);return{position:K,indices:Q,texture:J,lighting:Y,vertexCount:18,scalePadded:1.6,scaleUnpadded:1.5732,is3D:!0}}),s=new W((q)=>{let K=V(q,[U(0.5,[[1,1,0],[0,1,0],[0,1,1],[1,1,1],[0,1,1],[0,1,0],[0,0,0],[0,0,1],[1,1,1],[0,1,1],[0,0,1],[1,0,1]]),U(0.53125,[[1,1,0],[0,1,0],[0,1,1],[1,1,1],[1,0,0],[0,0,0],[0,0,1],[1,0,1],[0,1,1],[0,1,0],[0,0,0],[0,0,1],[1,1,0],[1,1,1],[1,0,1],[1,0,0],[1,1,1],[0,1,1],[0,0,1],[1,0,1],[0,1,0],[1,1,0],[1,0,0],[0,0,0]])]),Q=O(q,9),J=C(q,8,[[1,0],[0,1],[1,1],[5,0],[6,0],[4,1],[6,1],[5,1],[7,1]]),Y=R(q,[255,162,111,255,102,162,190,111,184]);return{position:K,indices:Q,texture:J,lighting:Y,vertexCount:54,scalePadded:1.12,scaleUnpadded:0.836,is3D:!0}}),u=new W((q)=>{let K=V(q,[U(0.5,[[1,1,0],[0,1,0],[0,1,1],[1,1,1],[0,1,1],[0,1,0],[0,0,0],[0,0,1],[1,1,1],[0,1,1],[0,0,1],[1,0,1]]),U(0.53125,[[1,1,0],[0,1,0],[0,1,1],[1,1,1],[1,0,0],[0,0,0],[0,0,1],[1,0,1],[0,1,1],[0,1,0],[0,0,0],[0,0,1],[1,1,0],[1,1,1],[1,0,1],[1,0,0],[1,1,1],[0,1,1],[0,0,1],[1,0,1],[0,1,0],[1,1,0],[1,0,0],[0,0,0]])]),Q=O(q,9),J=C(q,3,[[0,0],[0,1],[1,0],[2,0],[0,2],[1,1],[1,2],[2,1],[2,2]]),Y=R(q,[255,162,111,255,102,162,190,111,184]);return{position:K,indices:Q,texture:J,lighting:Y,vertexCount:54,scalePadded:1.12,scaleUnpadded:0.836,is3D:!0}});function U(q,K){return K.flat().map((Q)=>(Q*2-1)*q)}function j(q,K,Q){let J=q.createBuffer();return q.bindBuffer(K,J),q.bufferData(K,Q,q.STATIC_DRAW),J}function V(q,K){return j(q,q.ARRAY_BUFFER,new Float32Array(K.flat()))}function O(q,K){let Q=[...Array(K).keys()].map((J)=>[J*4,J*4+1,J*4+2,J*4,J*4+2,J*4+3]).flat();return j(q,q.ELEMENT_ARRAY_BUFFER,new Uint16Array(Q))}function C(q,K,Q){let J=Q.map((Y)=>[Y[0]+1,Y[1]+0,Y[0]+0,Y[1]+0,Y[0]+0,Y[1]+1,Y[0]+1,Y[1]+1]).flat().map((Y)=>Y/K);return j(q,q.ARRAY_BUFFER,new Float32Array(J))}function R(q,K){let Q=K.map((J)=>J/255).map((J)=>[J,J,J]).map((J)=>[J,J,J,J]).flat(2);return j(q,q.ARRAY_BUFFER,new Float32Array(Q))}var d=["attribute vec4 aVertexPosition;","uniform mat4 uModelViewMatrix;","uniform mat4 uProjectionMatrix;","","attribute     vec2 aTextureCoord;","varying highp vec2 vTextureCoord;","attribute     vec3 aLighting;","varying highp vec3 vLighting;","","void main(void) {","    gl_Position = uProjectionMatrix * uModelViewMatrix * aVertexPosition;","","    vTextureCoord = aTextureCoord;","    vLighting = aLighting;","}"].join(""),n=["precision highp float;","","uniform sampler2D uTexture;","uniform mat3 uTextureMatrix; /* Offset applied to texture */","varying highp vec2 vTextureCoord;","","varying highp vec3 vLighting; /* Prebaked lighting */","uniform bool uLightingActive;","","void main() {","    highp vec4 texelColor = texture2D(uTexture, (uTextureMatrix * vec3(vTextureCoord, 1.0)).xy);","    gl_FragColor = texelColor;","","    if (texelColor.a == 0.0) {","        discard;","    }","","    if (uLightingActive) {","        gl_FragColor *= vec4(vLighting, 1);","    }","}"].join("");function A(q){let K=y(q,q.VERTEX_SHADER,d),Q=y(q,q.FRAGMENT_SHADER,n),J=q.createProgram();if(q.attachShader(J,K),q.attachShader(J,Q),q.linkProgram(J),!q.getProgramParameter(J,q.LINK_STATUS))return alert(`Unable to initialize the shader program: ${q.getProgramInfoLog(J)}`),null;return{program:J,locations:{aVertexPosition:q.getAttribLocation(J,"aVertexPosition"),uProjectionMatrix:q.getUniformLocation(J,"uProjectionMatrix"),uModelViewMatrix:q.getUniformLocation(J,"uModelViewMatrix"),aTextureCoord:q.getAttribLocation(J,"aTextureCoord"),aLighting:q.getAttribLocation(J,"aLighting"),uLightingActive:q.getUniformLocation(J,"uLightingActive"),uTextureMatrix:q.getUniformLocation(J,"uTextureMatrix"),uTexture:q.getUniformLocation(J,"uTexture")}}}function y(q,K,Q){let J=q.createShader(K);if(q.shaderSource(J,Q),q.compileShader(J),!q.getShaderParameter(J,q.COMPILE_STATUS))return alert(`An error occurred compiling the shaders: ${q.getShaderInfoLog(J)}`),q.deleteShader(J),null;return J}function B(q){return new Promise((K,Q)=>{let J=new Image;J.onload=()=>{K(J)},J.onerror=(Y)=>{Q(new Error(`Could not load texture "${q}".`,{cause:Y}))},J.src=q})}function P(q,K,Q,J){let Y=q.createTexture();if(q.bindTexture(q.TEXTURE_2D,Y),q.texImage2D(q.TEXTURE_2D,0,q.RGBA,q.RGBA,q.UNSIGNED_BYTE,K),I(Q)&&I(J))q.generateMipmap(q.TEXTURE_2D);else q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE);return q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MIN_FILTER,q.NEAREST),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MAG_FILTER,q.NEAREST),Y}async function T(q,K){let Q;if(typeof K==="string")Q=await B(K);else Q=K;return P(q,Q,Q.width,Q.height)}function I(q){return(q&q-1)===0}async function i(q){return new E(await B(q))}class E{constructor(q){let K=document.createElement("canvas");K.width=q.width,K.height=q.height,this.ctx=K.getContext("2d"),this.ctx.drawImage(q,0,0,q.width,q.height,0,0,q.width,q.height)}getTexture(q,K,Q,J){return this.ctx.getImageData(q,K,Q,J)}}var{mat3:N,mat4:_}=window.glMatrix||{};function v(q,K,Q,J,Y,F,X,D){let $=q.canvas.clientWidth/q.canvas.clientHeight,G=_.create();_.ortho(G,-$,$,-1,1,-10,10);let k=_.create();_.translate(k,k,X);let H=1/((Q?J.scalePadded:J.scaleUnpadded)*D);if(_.scale(k,k,[H,H,H]),J.is3D)_.rotate(k,k,30*Math.PI/180,[1,0,0]),_.rotate(k,k,45*Math.PI/180,[0,1,0]);if(L(q,K.locations.aVertexPositions,J.position,3),L(q,K.locations.aTextureCoord,J.texture,2),L(q,K.locations.aLighting,J.lighting,3),q.bindBuffer(q.ELEMENT_ARRAY_BUFFER,J.indices),q.useProgram(K.program),q.uniform1i(K.locations.uLightingActive,1),q.uniformMatrix4fv(K.locations.uProjectionMatrix,!1,G),q.uniformMatrix4fv(K.locations.uModelViewMatrix,!1,k),q.uniformMatrix3fv(K.locations.uTextureMatrix,!1,N.create()),q.activeTexture(q.TEXTURE0),q.bindTexture(q.TEXTURE_2D,Y),q.uniform1i(K.locations.uTexture,0),q.drawElements(q.TRIANGLES,J.vertexCount,q.UNSIGNED_SHORT,0),!F)return;q.depthMask(!1),q.depthFunc(q.EQUAL),q.uniform1i(K.locations.uLightingActive,0),q.blendFunc(q.SRC_COLOR,q.ONE),q.bindTexture(q.TEXTURE_2D,F);let Z=N.create(),z=0.5;N.scale(Z,Z,[z,z,z]);let f=M()%3000/3000/z;N.translate(Z,Z,[f,0]),N.rotate(Z,Z,b(-50),[0,0,1]),q.uniformMatrix3fv(K.locations.uTextureMatrix,!1,Z),q.drawElements(q.TRIANGLES,J.vertexCount,q.UNSIGNED_SHORT,0),Z=N.create(),N.scale(Z,Z,[z,z,z]);let c=M()%4873/4873/z;N.translate(Z,Z,[-c,0]),N.rotate(Z,Z,b(10),[0,0,1]),q.uniformMatrix3fv(K.locations.uTextureMatrix,!1,Z),q.drawElements(q.TRIANGLES,J.vertexCount,q.UNSIGNED_SHORT,0),S(q,!1)}function S(q,K){if(K)q.clearColor(0,0,0,0),q.clearDepth(1),q.clear(q.COLOR_BUFFER_BIT|q.DEPTH_BUFFER_BIT);q.enable(q.DEPTH_TEST),q.depthFunc(q.LEQUAL),q.depthMask(!0),q.enable(q.BLEND),q.blendFunc(q.SRC_ALPHA,q.ONE_MINUS_SRC_ALPHA)}function b(q){return q*Math.PI/180}function M(){return Date.now()}function L(q,K,Q,J){q.bindBuffer(q.ARRAY_BUFFER,Q),q.vertexAttribPointer(K,J,q.FLOAT,!1,0,0),q.enableVertexAttribArray(K)}function Kq(q,K,Q){return o(q,[K],Q)}async function o(q,K,Q){if(!window.glMatrix?.mat4)throw new Error("Could not find matrix library. Please ensure you include glMatrix v3.");if(Q||={},Q.antialias===void 0)Q.antialias=!1;let J=q.getContext("webgl",Q);if(J===null)throw new Error("Could not initialize WebGL. Your browser may not support it.");let Y=A(J),F=[()=>S(J,!0)];for(let $ of K){let G=await T(J,$.texture),k=$.enchanted?P(J,w,64,64):null,H=$.modelType.create(J),Z=$.translation||[0,0,0],z=1/($.scale||1);F.push(()=>v(J,Y,$.inInventory,H,G,k,Z,z))}let X;function D(){if(F.forEach(($)=>$()),X)X=requestAnimationFrame(D)}return X=requestAnimationFrame(D),new h(()=>{cancelAnimationFrame(X),X=null,J.getExtension("WEBGL_lose_context")?.loseContext()})}class h{constructor(q){this.destroyFunc=q}destroy(){this.destroyFunc()}}export{Kq as createRenderer,o as createMultiRenderer,i as createAtlas,E as TextureAltlas,h as Renderer,W as ModelType,s as MODEL_SKULL_SKIN,u as MODEL_SKULL_COMPACT,x as MODEL_ITEM,m as MODEL_CUBE};
