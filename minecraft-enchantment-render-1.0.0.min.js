// minecraft-enchantment-render v1.0.0
// 
// MIT License
// 
// Copyright (c) 2025 L3g7
// 
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
// 
// The above copyright notice and this permission notice shall be included in all
// copies or substantial portions of the Software.
// 
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
// SOFTWARE.
// 
class O{constructor(q){this.generator=q}create(q){return this.generator(q)}}var n=[104,49,91,56,79,98,109,89,86,113,107,132,130,160,108,106,116,109,163,221,184,160,149,131,134,134,63,24,65,78,94,125,121,121,131,93,126,143,144,166,155,189,204,255,229,218,209,197,154,105,104,156,139,137,87,80,111,87,95,103,108,148,152,75],D=new ImageData(new Uint8ClampedArray(new Array(64).fill(n.map((q)=>[q*128/255,q*64/255,q*204/255,255])).flat(2)),64,64),s=new O((q)=>{let J=_(q,N(1,[[1,1,1],[0,1,1],[0,0,1],[1,0,1]])),Q=W(q,1),K=j(q,1,[[0,0]]),Y=V(q,[255]);return{position:J,indices:Q,texture:K,lighting:Y,vertexCount:6,scalePadded:1,scaleUnpadded:1,is3D:!1}}),m=new O((q)=>{let J=_(q,N(1,[[0,1,1],[1,1,1],[1,1,0],[0,1,0],[0,1,1],[0,1,0],[0,0,0],[0,0,1],[1,1,1],[0,1,1],[0,0,1],[1,0,1]])),Q=W(q,3),K=j(q,2,[[0,0],[0,1],[1,0]]),Y=V(q,[255,162,111]);return{position:J,indices:Q,texture:K,lighting:Y,vertexCount:18,scalePadded:1.6,scaleUnpadded:1.5732,is3D:!0}}),d=new O((q)=>{let J=_(q,[N(0.5,[[1,1,0],[0,1,0],[0,1,1],[1,1,1],[0,1,1],[0,1,0],[0,0,0],[0,0,1],[1,1,1],[0,1,1],[0,0,1],[1,0,1]]),N(0.53125,[[1,1,0],[0,1,0],[0,1,1],[1,1,1],[1,0,0],[0,0,0],[0,0,1],[1,0,1],[0,1,1],[0,1,0],[0,0,0],[0,0,1],[1,1,0],[1,1,1],[1,0,1],[1,0,0],[1,1,1],[0,1,1],[0,0,1],[1,0,1],[0,1,0],[1,1,0],[1,0,0],[0,0,0]])]),Q=W(q,9),K=j(q,8,[[1,0],[0,1],[1,1],[5,0],[6,0],[4,1],[6,1],[5,1],[7,1]]),Y=V(q,[255,162,111,255,102,162,190,111,184]);return{position:J,indices:Q,texture:K,lighting:Y,vertexCount:54,scalePadded:1.12,scaleUnpadded:0.836,is3D:!0}}),i=new O((q)=>{let J=_(q,[N(0.5,[[1,1,0],[0,1,0],[0,1,1],[1,1,1],[0,1,1],[0,1,0],[0,0,0],[0,0,1],[1,1,1],[0,1,1],[0,0,1],[1,0,1]]),N(0.53125,[[1,1,0],[0,1,0],[0,1,1],[1,1,1],[1,0,0],[0,0,0],[0,0,1],[1,0,1],[0,1,1],[0,1,0],[0,0,0],[0,0,1],[1,1,0],[1,1,1],[1,0,1],[1,0,0],[1,1,1],[0,1,1],[0,0,1],[1,0,1],[0,1,0],[1,1,0],[1,0,0],[0,0,0]])]),Q=W(q,9),K=j(q,3,[[0,0],[0,1],[1,0],[2,0],[0,2],[1,1],[1,2],[2,1],[2,2]]),Y=V(q,[255,162,111,255,102,162,190,111,184]);return{position:J,indices:Q,texture:K,lighting:Y,vertexCount:54,scalePadded:1.12,scaleUnpadded:0.836,is3D:!0}});function N(q,J){return J.flat().map((Q)=>(Q*2-1)*q)}function U(q,J,Q){let K=q.createBuffer();return q.bindBuffer(J,K),q.bufferData(J,Q,q.STATIC_DRAW),K}function _(q,J){return U(q,q.ARRAY_BUFFER,new Float32Array(J.flat()))}function W(q,J){let Q=[...Array(J).keys()].map((K)=>[K*4,K*4+1,K*4+2,K*4,K*4+2,K*4+3]).flat();return U(q,q.ELEMENT_ARRAY_BUFFER,new Uint16Array(Q))}function j(q,J,Q){let K=Q.map((Y)=>[Y[0]+1,Y[1]+0,Y[0]+0,Y[1]+0,Y[0]+0,Y[1]+1,Y[0]+1,Y[1]+1]).flat().map((Y)=>Y/J);return U(q,q.ARRAY_BUFFER,new Float32Array(K))}function V(q,J){let Q=J.map((K)=>K/255).map((K)=>[K,K,K]).map((K)=>[K,K,K,K]).flat(2);return U(q,q.ARRAY_BUFFER,new Float32Array(Q))}var o=["attribute vec4 aVertexPosition;","uniform mat4 uModelViewMatrix;","uniform mat4 uProjectionMatrix;","","attribute     vec2 aTextureCoord;","varying highp vec2 vTextureCoord;","attribute     vec3 aLighting;","varying highp vec3 vLighting;","","void main(void) {","    gl_Position = uProjectionMatrix * uModelViewMatrix * aVertexPosition;","","    vTextureCoord = aTextureCoord;","    vLighting = aLighting;","}"].join(""),a=["precision highp float;","","uniform sampler2D uTexture;","uniform mat3 uTextureMatrix; /* Offset applied to texture */","varying highp vec2 vTextureCoord;","","varying highp vec3 vLighting; /* Prebaked lighting */","uniform bool uLightingActive;","","void main() {","    highp vec4 texelColor = texture2D(uTexture, (uTextureMatrix * vec3(vTextureCoord, 1.0)).xy);","    gl_FragColor = texelColor;","","    if (texelColor.a == 0.0) {","        discard;","    }","","    if (uLightingActive) {","        gl_FragColor *= vec4(vLighting, 1);","    }","}"].join("");function A(q){let J=I(q,q.VERTEX_SHADER,o),Q=I(q,q.FRAGMENT_SHADER,a),K=q.createProgram();if(q.attachShader(K,J),q.attachShader(K,Q),q.linkProgram(K),!q.getProgramParameter(K,q.LINK_STATUS))return alert(`Unable to initialize the shader program: ${q.getProgramInfoLog(K)}`),null;return{program:K,locations:{aVertexPosition:q.getAttribLocation(K,"aVertexPosition"),uProjectionMatrix:q.getUniformLocation(K,"uProjectionMatrix"),uModelViewMatrix:q.getUniformLocation(K,"uModelViewMatrix"),aTextureCoord:q.getAttribLocation(K,"aTextureCoord"),aLighting:q.getAttribLocation(K,"aLighting"),uLightingActive:q.getUniformLocation(K,"uLightingActive"),uTextureMatrix:q.getUniformLocation(K,"uTextureMatrix"),uTexture:q.getUniformLocation(K,"uTexture")}}}function I(q,J,Q){let K=q.createShader(J);if(q.shaderSource(K,Q),q.compileShader(K),!q.getShaderParameter(K,q.COMPILE_STATUS))return alert(`An error occurred compiling the shaders: ${q.getShaderInfoLog(K)}`),q.deleteShader(K),null;return K}async function C(q){let J=await(await fetch(q)).blob();return await self.createImageBitmap(J)}function y(q,J,Q,K){let Y=q.createTexture();if(q.bindTexture(q.TEXTURE_2D,Y),q.texImage2D(q.TEXTURE_2D,0,q.RGBA,q.RGBA,q.UNSIGNED_BYTE,J),T(Q)&&T(K))q.generateMipmap(q.TEXTURE_2D);else q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE);return q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MIN_FILTER,q.NEAREST),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MAG_FILTER,q.NEAREST),Y}async function M(q,J){let Q;if(typeof J==="string")Q=await C(J);else Q=J;return y(q,Q,Q.width,Q.height)}function T(q){return(q&q-1)===0}async function r(q){let J;if(typeof q==="string")J=await C(q);else J=q;return new P(J)}class P{constructor(q){let J=document.createElement("canvas");J.width=q.width,J.height=q.height,this.ctx=J.getContext("2d"),this.ctx.drawImage(q,0,0,q.width,q.height,0,0,q.width,q.height)}getTexture(q,J,Q,K){return this.ctx.getImageData(q,J,Q,K)}}var{mat3:k,mat4:z}=self.glMatrix||{};function h(q,J,Q,K,Y,X,G,f,p){let B=q.canvas.clientWidth/q.canvas.clientHeight,R=z.create();z.ortho(R,-B,B,-1,1,-10,10);let $=z.create();z.translate($,$,G);let F=1/((Q?K.scalePadded:K.scaleUnpadded)*f);if(z.scale($,$,[F,p?-F:F,F]),K.is3D)z.rotate($,$,30*Math.PI/180,[1,0,0]),z.rotate($,$,45*Math.PI/180,[0,1,0]);if(E(q,J.locations.aVertexPositions,K.position,3),E(q,J.locations.aTextureCoord,K.texture,2),E(q,J.locations.aLighting,K.lighting,3),q.bindBuffer(q.ELEMENT_ARRAY_BUFFER,K.indices),q.useProgram(J.program),q.uniform1i(J.locations.uLightingActive,1),q.uniformMatrix4fv(J.locations.uProjectionMatrix,!1,R),q.uniformMatrix4fv(J.locations.uModelViewMatrix,!1,$),q.uniformMatrix3fv(J.locations.uTextureMatrix,!1,k.create()),q.activeTexture(q.TEXTURE0),q.bindTexture(q.TEXTURE_2D,Y),q.uniform1i(J.locations.uTexture,0),q.drawElements(q.TRIANGLES,K.vertexCount,q.UNSIGNED_SHORT,0),!X)return;q.depthMask(!1),q.depthFunc(q.EQUAL),q.uniform1i(J.locations.uLightingActive,0),q.blendFunc(q.SRC_COLOR,q.ONE),q.bindTexture(q.TEXTURE_2D,X);let Z=k.create(),H=0.5;k.scale(Z,Z,[H,H,H]);let x=b()%3000/3000/H;k.translate(Z,Z,[x,0]),k.rotate(Z,Z,v(-50),[0,0,1]),q.uniformMatrix3fv(J.locations.uTextureMatrix,!1,Z),q.drawElements(q.TRIANGLES,K.vertexCount,q.UNSIGNED_SHORT,0),Z=k.create(),k.scale(Z,Z,[H,H,H]);let u=b()%4873/4873/H;k.translate(Z,Z,[-u,0]),k.rotate(Z,Z,v(10),[0,0,1]),q.uniformMatrix3fv(J.locations.uTextureMatrix,!1,Z),q.drawElements(q.TRIANGLES,K.vertexCount,q.UNSIGNED_SHORT,0),L(q,!1)}function L(q,J){if(J)q.clearColor(0,0,0,0),q.clearDepth(1),q.clear(q.COLOR_BUFFER_BIT|q.DEPTH_BUFFER_BIT);q.enable(q.DEPTH_TEST),q.depthFunc(q.LEQUAL),q.depthMask(!0),q.enable(q.BLEND),q.blendFunc(q.SRC_ALPHA,q.ONE_MINUS_SRC_ALPHA)}function v(q){return q*Math.PI/180}function b(){return Date.now()}function E(q,J,Q,K){q.bindBuffer(q.ARRAY_BUFFER,Q),q.vertexAttribPointer(J,K,q.FLOAT,!1,0,0),q.enableVertexAttribArray(J)}function Yq(q,J,Q){if(!Array.isArray(J))J=[J];return new c(q,Q,J)}class w{models;constructor(q){this.models=Array.isArray(q)?q:[q]}destroy(){}renderShared(q,J,Q){}createSharedRenderer(q,J,Q){}}class c extends w{sharingRenderers;pixelBuffer;constructor(q,J,Q){super(Q);if(this.sharingRenderers=[],this.pixelBuffer=null,!self?.glMatrix?.mat4)throw new Error("Could not find matrix library. Please ensure you include glMatrix v3.");if(J||={},J.antialias===void 0)J.antialias=!1;let K=q.getContext("webgl",J);if(K===null)throw new Error("Could not initialize WebGL. Your browser may not support it.");this.gl=K,this.programInfo=A(K);let Y=async()=>{if(await this.renderFrame(),this.activeHandle)this.activeHandle=requestAnimationFrame(Y)};this.activeHandle=requestAnimationFrame(Y)}async renderFrame(){let q=this.gl.canvas.width,J=this.gl.canvas.height;for(let Q of this.sharingRenderers){if(await this.renderModels(Q.models,!0),this.pixelBuffer==null)this.pixelBuffer=new Uint8ClampedArray(q*J*4);this.gl.readPixels(0,0,q,J,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.pixelBuffer),Q.copy(this.pixelBuffer)}await this.renderModels(this.models,!1)}async renderModels(q,J){L(this.gl,!0);for(let Q of q)await this.prepareDraw(Q),Q.draw(J)}async prepareDraw(q){if(q.draw)return;let J=await M(this.gl,q.texture),Q=q.enchanted?y(this.gl,D,64,64):null,K=q.modelType.create(this.gl),Y=q.translation||[0,0,0],X=1/(q.scale||1);q.draw=(G)=>h(this.gl,this.programInfo,q.inInventory,K,J,Q,Y,X,G)}destroy(){if(this.activeHandle!=null)cancelAnimationFrame(this.activeHandle),this.activeHandle=null,this.gl.getExtension("WEBGL_lose_context")?.loseContext()}renderShared(q,J,Q){new S(q,Q,this,J,!0)}createSharedRenderer(q,J,Q){return new S(q,Q,this,J,!1)}}class S extends w{constructor(q,J,Q,K,Y){super(K);this.oneshot=Y,this.ctx=q.getContext("2d",J||{}),this.backend=Q,this.backend.sharingRenderers.push(this)}copy(q){if(this.ctx.putImageData(new ImageData(q,this.ctx.canvas.width,this.ctx.canvas.height),0,0),this.oneshot)this.destroy()}destroy(){let q=this.backend.sharingRenderers.indexOf(this);if(q!==-1)this.backend.sharingRenderers.splice(q,1)}}export{Yq as createRenderer,r as createAtlas,P as TextureAtlas,w as Renderer,O as ModelType,d as MODEL_SKULL_SKIN,i as MODEL_SKULL_COMPACT,s as MODEL_ITEM,m as MODEL_CUBE};
